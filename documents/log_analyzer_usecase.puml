@startuml log_analyzer_usecase
title Log Analyzer - Use Case Diagram (RAG Flow Highlighted)
skinparam backgroundColor #FEFEFE
skinparam usecase {
    BackgroundColor #F0F0F0
    BorderColor #333333
    ArrowColor #333333
}
skinparam rectangle {
    BackgroundColor #E8F4F8
    BorderColor #0066CC
}

left to right direction

actor User

rectangle "Log Analyzer System" {
    usecase "Upload Log File" as UC1
    usecase "Validate File" as UC2

    rectangle "Data Ingestion Phase" {
        usecase "Load Text File" as UC3
        usecase "Split Into Chunks" as UC4
        usecase "Generate Embeddings" as UC5
        usecase "Store in Vector DB" as UC6
    }

    package "RAG Pipeline (Core Flow)" #FFE5CC {
        usecase "Query Analysis Request" as UC7

        rectangle "Retrieval (R)" #FFCCCC {
            usecase "MMR Search\n(k=1000)" as RAG_R
            usecase "Retrieve Top Chunks" as RAG_R2
        }

        rectangle "Augmentation (A)" #FFDDCC {
            usecase "Combine Context" as RAG_A
            usecase "Build Prompt" as RAG_A2
        }

        rectangle "Generation (G)" #FFFFCC {
            usecase "Call LLM Model" as RAG_G
            usecase "Generate Response" as RAG_G2
        }
    }

    usecase "Display Analysis Results" as UC8
}

User --> UC1 : Upload
UC1 --> UC2 : Submit
UC2 --> UC3 : Valid file
UC3 --> UC4 : Extract content
UC4 --> UC5 : Process chunks
UC5 --> UC6 : Store vectors

User --> UC7 : Ask questions
UC7 --> RAG_R : Submit query
RAG_R --> RAG_R2 : Fetch top-k
RAG_R2 --> RAG_A : Pass context
RAG_A --> RAG_A2 : Format context
RAG_A2 --> RAG_G : Execute prompt
RAG_G --> RAG_G2 : Get response
RAG_G2 --> UC8 : Return results
UC8 --> User : Display

UC2 -.-> UC3 : skip if invalid

note bottom of User
  User interacts with Streamlit UI
  to upload logs and query analysis
end note

note right of RAG_R
  Similarity search in
  Pinecone Vector Store
end note

note right of RAG_A
  Context preparation using
  LangChain chains
end note

note right of RAG_G
  LLM inference
  (OpenAI/Ollama/Bedrock)
end note

@enduml
